<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head'); %>
  </head>
  <%- include('./partials/nav'); %>
  <div id='title' class="container" style="margin-top: 3em;">
    <div class="row justify-content-center">
      <h1 class="display-4"><%= Movie.name %></h1>
    </div>
  </div>

  <div class="container" style="margin-top: 3em;">
    <div class="row justify-content-start">
      <div class="col col-lg-6" style="margin-top: 2em;">
        <img src="<%= Movie.poster %>">
      </div>
      <div class="col-6" style="margin-top: 2em;">
        <%= Movie.description %>
        <div style="margin-top: 2em;">
          Released: <%= Movie.release %>
        </div>
        <div style="margin-top: 1em; font-style: italic;">
          <% Movie.categories.forEach(function(n) { %>
          <%= n %>
          <% }) %>
        </div>
        <div class='row' style="margin-top: 2em; margin-left: 1em;">
          <button class="btn btn-outline-info" id="add_to_cart">
            Add to cart
          </button>
          <div style="margin-left: 1em;">
            Qty:
          </div>
          <div>
            <div class="pass-quantity col-5">
              <input id='input' class="form-control" type="number" value="1" min="1">
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row justify-content-start" style="margin-top: 1em;">
      <div class="col col-lg-1"">
        $<%= (Movie.price / 100).toFixed(2) %>
      </div>
      <div class="col">
        In Stock:
        <%= Movie.stock %>
      </div>
    </div>
  </div>
  <script>
    $(document).ready(function() {

      var max_chars = 2;
      $('#input').keydown( function(e){
          if ($(this).val().length >= max_chars) {
              $(this).val($(this).val().substr(0, max_chars));
          }
      });

      $('#input').keyup( function(e){
          if ($(this).val().length >= max_chars) {
              $(this).val($(this).val().substr(0, max_chars));
          }
      });

      $('.pass-quantity input').change(function(e) {
        if ($(this).val().length >= max_chars) {
              $(this).val($(this).val().substr(0, max_chars));
          }
      })

      var quantity = 0

      $('#add_to_cart').click(function() {

        quantity = $('.pass-quantity input').val()
        console.log(quantity)

        if(quantity < '<%= Movie.stock %>') {
          var movies = localStorage.getItem('movies')
          var current_movie = '<%= Movie._id %> '
          if(movies === null) {
            localStorage.setItem('movies', current_movie)
          } else {
            localStorage.setItem('movies', movies + current_movie)
          }
          console.log(localStorage.getItem('movies'))

        } else {
          alert('TEMP // Please lower quantity')
        }
      })

    })
  </script>

  <%- include('./partials/footer'); %>
</html>